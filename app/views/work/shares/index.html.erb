<% content_for(:title, "Work Shares") %>

<% if @period.nil? %>
  <div class="none-found">
    <%= t("work.no_periods_html", link: link_to(t("work.create_one"), work_periods_path)) %>
  </div>
<% else %>
  <p class="intro"><%= t("work/shares.intro") %></p>
  <%= form_for(@period, url: work_shares_path, method: :post, html: {class: "work--share-form"}) do |f| %>
    <%= f.hidden_field :id %>
    <% %w(adult child).each do |kind| %>
      <h2><%= t("common.#{kind.pluralize}") %></h2>
      <div class="work-share-section">
        <% @users_by_kind[kind].each do |user| %>
          <% share = @shares_by_user[user.id].decorate %>
          <%= f.simple_fields_for(:shares_attributes, share, index: user.id) do |share_fields| %>
            <div class="work-share-selector">
              <%= share_fields.hidden_field :id %>
              <%= share_fields.hidden_field :user_id %>
              <label><%= link_to user.full_name, user_path(user) %></label>
              <%= share_fields.select(:portion, share.select_options,
                {prompt: share.new_record? ? t("work/shares.portion_options.not_set") : nil},
                class: "form-control") %>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>

    <%= form_actions do %>
      <%= f.button t("common.save"), class: "btn btn-primary" %>
    <% end %>
  <% end %>
<% end %>

<%= javascript_tag do %>
  $(function() {
    new Gather.Views.DirtyChecker({el: '.work--share-form'});
  });
<% end %>
