<% cache @cache_key do %>
  <%# We need to call this from inside the cached block b/c it triggers DB queries. %>
  <div class="shifts-main flowing-columns">
    <% if jobs.empty? %>
      <div class="col-sm-12 none-found">
        No jobs found. <%= lenses.no_result_clear_filter_link %>
      </div>
    <% else %>
      <% jobs.each do |job| %>
        <% job.shifts.each do |shift| %>
          <% shift = shift.decorate %>
          <div class="shift-card section <%= "taken" if shift.taken? %>"
            onclick="window.location.href='<%= work_shift_path(shift) %>'">
            <table>
              <tr>
                <td>
                  <%= link_to(job.title, shift, class: "title") %>
              </td>
                <td>
                  <div class="hours" title="<%= I18n.t("work.num_hours", num: shift.hours_formatted) %>">
                    <%= shift.hours_formatted %>h
                  </div>
                </td>
              </tr>
              <tr>
                <td>
                  <div class="shift-times"><%= shift.times %></div>
                </td>
                <td class="photo-cell" rowspan="2">
                  <div class="photos <%= "single" if shift.assignments.size == 1 %>">
                    <% if shift.taken? %>
                      <%= shift.photos %>
                    <% end %>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="owners-cell">
                  <% shift.assignments.each do |assignment| %>
                    <div class="owner-name">
                      <%= assignment.user.decorate.name_with_inactive %>
                      <% if assignment.preassigned? %>
                        &nbsp;<%= icon_tag("thumb-tack", title: I18n.t("work.preassigned")) %>
                      <% end %>
                    </div>
                  <% end %>
                  <% unless shift.taken? %>
                    <a href="#" class="signup-link"><%= icon_tag("bolt") %> Sign Up!</a>
                  <% end %>
                </td>
              </tr>
            </table>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
<% end %>
